/*!
 * tjGallery 1.2
 * http://tj-s.ru
 * @copyright	Tod, tod@tj-s.ru
 * @license		MIT License
 */
!function(o){const s="tjGallery";function a(t){var a=t.data(s),c=t.width();t.each(function(){const h=[];let s={items:[]};o(this).find(a.selector).each(function(){let t=o(this),i;if(t.is("img"))i=t,t=o('<div class="tjGalleryItem">').insertBefore(i).append(i);else{if(i=t.find("img"),0===i.length)return;t=o('<div class="tjGalleryItem">').insertBefore(t).append(t)}t.css({width:"auto",float:"left",position:"relative"});var e=l(i);const n={pic:i,container:t,originalHeight:e.height,originalWidth:e.width};n.aspect=n.originalWidth/n.originalHeight,n.scale=a.rowMinHeight/n.originalHeight,n.width=n.originalWidth*n.scale,n.height=n.originalHeight*n.scale;e=r(s.items,n);c<e&&(h.push(s),s={items:[]}),s.items.push(n)}),1===s.items.length&&1<h[h.length-1].items.length?h[h.length-1].items.push(s.items[0]):h.push(s),o.each(h,function(t,e){e.scale=(c-(e.items.length-1)*a.margin)/r(e.items),o.each(e.items,function(t,i){e.scale&&(i.width=i.width*e.scale,i.height=i.height*e.scale),i.width=Math.trunc(100*i.width)/100,i.pic.css({height:i.height+"px",width:i.width+"px"}),i.container.css({width:i.width+"px",marginBottom:a.margin+"px"}),0<t?i.container.css({marginLeft:a.margin+"px"}):i.container.css({clear:"left"})})})})}function c(i){var e=i.data(s);i.each(function(){const t=o(this);t.find(e.selector).each(function(){const t=o(this);t.is("img")||t.find("img").css({width:"auto",height:"auto"}),t.removeAttr("style"),t.appendTo(i)}),t.find("div:empty").remove()})}function r(t,i){let e=0;return o.each(t,function(t,i){e+=i.width}),i&&(e+=i.width),e}function l(t){var i=t.attr("width")||t.width(),t=t.attr("height")||t.height();return i&&t?{width:i,height:t}:null}o.fn.tjGallery=function(t){if("destroy"!==t)return function(e){const n=this.find("img");if(!(n.length<2)){e=o.extend({selector:"img",rowMinHeight:180,margin:5},e);this.data(s,e);var h=this;let t=this.width(),i=n.length;n.each(function(){if(l(o(this)))--i,0===i&&a(h);else{const t=new Image;this.onload=function(){--i,0===i&&a(h)},t.src=this.src}}),o(window).bind("resize."+s,function(){h.width()!==t&&(t=h.width(),c(h),a(h))})}}.call(this,t);c(this),this.removeData(s),o(window).unbind("."+s)}}(jQuery);